{
  "version": 3,
  "sources": ["../../models/articles.ts"],
  "sourcesContent": ["import * as db from '../helpers/database'\nimport * as DTO from '../interface/articles'\n\n//get a single article by its id\nexport const getById = async (id: any) => {\n  let query = \"SELECT * FROM articles WHERE ID = ?\"\n  let values = [id]\n  let data = await db.run_query(query, values);\n  return data;\n}\n\n//list all the articles in the database\nexport const getAll = async () => {\n  // TODO: use page, limit, order to give pagination\n  let query = \"SELECT * FROM articles;\"\n  let data = await db.run_query(query, null);\n  return data;\n}\n\n//create a new article in the database\nexport const add = async (article: any) => {\n  let keys = Object.keys(article);\n  let values = Object.values(article);\n  let key = keys.join(',');\n  let param = '';\n  for (let i: number = 0; i < values.length; i++) { param += '?,' }\n  param = param.slice(0, -1);\n  let query = `INSERT INTO articles (${key}) VALUES (${param})`;\n  try {\n    await db.run_insert(query, values);\n    return { status: 201 };\n  } catch (err: any) {\n    return err;\n  }\n}\n\nexport const update = async (id: number, article: DTO.iArticles, userId: number) => {\n  let articlesData = await getById(id)\n  if (articlesData.length) {\n    let articles = <DTO.iArticles>articlesData[0]\n    if (articles.authorid != userId) {\n      return { status: 500, err: \"You are not articles owner\" }\n    }\n  }\n\n  let updateItem = ''\n  Object.entries(article).forEach(entry => {\n    const [key, value] = entry;\n    if (updateItem != '')\n      updateItem += ', '\n\n    updateItem += `${key} = '${value}'`\n    console.log(key, value);\n  })\n  let query = `UPDATE articles SET ${updateItem} where id = ${id}`\n  try {\n    await db.run_update(query);\n    return { status: 201 };\n  } catch (err: any) {\n    return err;\n  }\n}\n\nexport const remove = async (id: number, userId: number) => {\n  if (!await checkArticlesOwner(id, userId)) {\n    return { status: 500, err: \"You are not articles owner\" }\n  }\n  // let articlesData = await getById(id)\n  // if (articlesData.length) {\n  //   let articles = <DTO.iArticles>articlesData[0]\n  //   if (articles.authorid != userId) {\n  //     return { status: 500, err: \"You are not articles owner\" }\n  //   }\n  // }\n  let query = `DELETE FROM articles WHERE id = ${id};`\n  try {\n    await db.run_delete(query);\n    return { status: 201 };\n  } catch (err: any) {\n    return err;\n  }\n}\n\nconst checkArticlesOwner = async (articlesId: number, loginUserId: number) => {\n  let articlesData = await getById(articlesId)\n  if (articlesData.length) {\n    let articles = <DTO.iArticles>articlesData[0]\n    if (articles.authorid != loginUserId)\n      return false\n    else\n      return true\n  }\n}"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAoB;AAIb,MAAM,UAAU,OAAO,OAAY;AACxC,MAAI,QAAQ;AACZ,MAAI,SAAS,CAAC,EAAE;AAChB,MAAI,OAAO,MAAM,GAAG,UAAU,OAAO,MAAM;AAC3C,SAAO;AACT;AAGO,MAAM,SAAS,YAAY;AAEhC,MAAI,QAAQ;AACZ,MAAI,OAAO,MAAM,GAAG,UAAU,OAAO,IAAI;AACzC,SAAO;AACT;AAGO,MAAM,MAAM,OAAO,YAAiB;AACzC,MAAI,OAAO,OAAO,KAAK,OAAO;AAC9B,MAAI,SAAS,OAAO,OAAO,OAAO;AAClC,MAAI,MAAM,KAAK,KAAK,GAAG;AACvB,MAAI,QAAQ;AACZ,WAAS,IAAY,GAAG,IAAI,OAAO,QAAQ,KAAK;AAAE,aAAS;AAAA,EAAK;AAChE,UAAQ,MAAM,MAAM,GAAG,EAAE;AACzB,MAAI,QAAQ,yBAAyB,gBAAgB;AACrD,MAAI;AACF,UAAM,GAAG,WAAW,OAAO,MAAM;AACjC,WAAO,EAAE,QAAQ,IAAI;AAAA,EACvB,SAAS,KAAP;AACA,WAAO;AAAA,EACT;AACF;AAEO,MAAM,SAAS,OAAO,IAAY,SAAwB,WAAmB;AAClF,MAAI,eAAe,MAAM,QAAQ,EAAE;AACnC,MAAI,aAAa,QAAQ;AACvB,QAAI,WAA0B,aAAa;AAC3C,QAAI,SAAS,YAAY,QAAQ;AAC/B,aAAO,EAAE,QAAQ,KAAK,KAAK,6BAA6B;AAAA,IAC1D;AAAA,EACF;AAEA,MAAI,aAAa;AACjB,SAAO,QAAQ,OAAO,EAAE,QAAQ,WAAS;AACvC,UAAM,CAAC,KAAK,KAAK,IAAI;AACrB,QAAI,cAAc;AAChB,oBAAc;AAEhB,kBAAc,GAAG,UAAU;AAC3B,YAAQ,IAAI,KAAK,KAAK;AAAA,EACxB,CAAC;AACD,MAAI,QAAQ,uBAAuB,yBAAyB;AAC5D,MAAI;AACF,UAAM,GAAG,WAAW,KAAK;AACzB,WAAO,EAAE,QAAQ,IAAI;AAAA,EACvB,SAAS,KAAP;AACA,WAAO;AAAA,EACT;AACF;AAEO,MAAM,SAAS,OAAO,IAAY,WAAmB;AAC1D,MAAI,CAAC,MAAM,mBAAmB,IAAI,MAAM,GAAG;AACzC,WAAO,EAAE,QAAQ,KAAK,KAAK,6BAA6B;AAAA,EAC1D;AAQA,MAAI,QAAQ,mCAAmC;AAC/C,MAAI;AACF,UAAM,GAAG,WAAW,KAAK;AACzB,WAAO,EAAE,QAAQ,IAAI;AAAA,EACvB,SAAS,KAAP;AACA,WAAO;AAAA,EACT;AACF;AAEA,MAAM,qBAAqB,OAAO,YAAoB,gBAAwB;AAC5E,MAAI,eAAe,MAAM,QAAQ,UAAU;AAC3C,MAAI,aAAa,QAAQ;AACvB,QAAI,WAA0B,aAAa;AAC3C,QAAI,SAAS,YAAY;AACvB,aAAO;AAAA;AAEP,aAAO;AAAA,EACX;AACF;",
  "names": []
}
